<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ETR Projections</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; margin:0; color:#111; background:#fff; }
    .wrap { max-width: 1200px; margin: 24px auto; padding: 0 16px; }
    .tabs { display:flex; gap:28px; border-bottom:1px solid #eee; margin-bottom:20px; }
    .tab { padding:12px 0; cursor:pointer; font-weight:700; color:#555; }
    .tab.active { color:#111; border-bottom:2px solid #111; }
    .section { display:none; }
    .section.active { display:block; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:16px; margin-bottom:18px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin:10px 0; }
    input, select, button { padding:8px 10px; }
    button { cursor:pointer; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
    th { font-weight:700; }
    .muted { color:#666; font-size:14px; }
    .right { text-align:right; }
    .pill { padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; color:#555; }
    .tight { margin: 6px 0; }
    .subtle { color:#999; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
      <div id="tab-proj" class="tab active">Projections</div>
      <div id="tab-daily" class="tab">Daily ETR Models</div>
    </div>

    <!-- ======================= PROJECTIONS (MAIN) ======================= -->
    <div id="sec-proj" class="section active">
      <div class="card">
        <h3 style="margin-top:0">Single Player Projections</h3>
        <div class="row">
          <input id="search-player" type="text" placeholder="Search player…" />
          <select id="filter-team"><option value="">All teams</option></select>
          <select id="filter-opp"><option value="">All opponents</option></select>
          <select id="filter-stat">
            <option value="">All stats</option>
            <option value="PTS">PTS</option>
            <option value="REB">REB</option>
            <option value="AST">AST</option>
            <option value="3PM">3PM</option>
            <option value="STL">STL</option>
            <option value="BLK">BLK</option>
            <option value="TO">TO</option>
            <option value="PRA">PRA</option>
          </select>
          <span class="pill" id="proj-date-pill">Date: –</span>
          <span class="muted">Source: latest blended artifact</span>
          <span class="muted"><a id="download-latest" href="/api/daily/projections/latest.csv" target="_blank" rel="noopener">Download CSV</a></span>
        </div>
        <div class="tight subtle" id="player-count"></div>
        <table id="players-table">
          <thead>
            <tr>
              <th>Player</th>
              <th>Team</th>
              <th>Opp</th>
              <th class="right">Min</th>
              <th class="right">PTS</th>
              <th class="right">REB</th>
              <th class="right">AST</th>
              <th class="right">3PM</th>
              <th class="right">STL</th>
              <th class="right">BLK</th>
              <th class="right">TO</th>
              <th class="right">PRA</th>
            </tr>
          </thead>
          <tbody id="players-tbody"></tbody>
        </table>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Team Projections (Aggregated)</h3>
        <div class="row">
          <select id="filter-team-agg"><option value="">All teams</option></select>
          <span class="muted">Sum of player projections by team.</span>
        </div>
        <table id="teams-table">
          <thead>
            <tr>
              <th>Team</th>
              <th class="right">PTS</th>
              <th class="right">REB</th>
              <th class="right">AST</th>
              <th class="right">3PM</th>
              <th class="right">STL</th>
              <th class="right">BLK</th>
              <th class="right">TO</th>
              <th class="right">PRA</th>
            </tr>
          </thead>
          <tbody id="teams-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ======================= DAILY ETR MODELS (UPLOADS) ======================= -->
    <div id="sec-daily" class="section">
      <div class="card">
        <h3 style="margin-top:0">Daily ETR Models</h3>
        <p class="muted">Drop today’s ETR projection CSV (columns: Player, Team, Opp, Minutes, PTS, REB, AST, 3PM, STL, BLK, TO, PRA). We’ll append it to history and retrain artifacts using <strong>all</strong> uploads.</p>

        <form id="etr-upload-form">
          <div class="row">
            <label for="etr-file"><strong>CSV file</strong></label>
            <input id="etr-file" name="file" type="file" accept=".csv" />
          </div>
          <div class="row">
            <label for="etr-date"><strong>Date (YYYY-MM-DD)</strong></label>
            <input id="etr-date" name="date" type="date" />
          </div>
          <div class="row">
            <button id="upload-btn" type="button">Upload &amp; Retrain</button>
            <span id="upload-status" class="muted"></span>
          </div>
        </form>
      </div>

      <div class="card">
        <h4 style="margin-top:0">Upload Library</h4>
        <p id="upload-library-note" class="muted"></p>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Size</th>
              <th>File</th>
            </tr>
          </thead>
          <tbody id="upload-library-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // simple tabs
    (function () {
      const tabProj = document.getElementById("tab-proj");
      const tabDaily = document.getElementById("tab-daily");
      const secProj = document.getElementById("sec-proj");
      const secDaily = document.getElementById("sec-daily");
      function activate(which) {
        tabProj.classList.toggle("active", which === "proj");
        tabDaily.classList.toggle("active", which === "daily");
        secProj.classList.toggle("active", which === "proj");
        secDaily.classList.toggle("active", which === "daily");
      }
      tabProj.addEventListener("click", () => activate("proj"));
      tabDaily.addEventListener("click", () => activate("daily"));
    })();
  </script>
  <script src="/static/daily.js"></script>
</body>
</html>

